define("discourse/plugins/discourse-patreon/discourse/routes/admin-plugins-patreon",["exports","discourse/models/group","discourse/lib/ajax","discourse/plugins/discourse-patreon/discourse/models/filter-rule"],function(e,t,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(r=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,s=e}finally{try{!r&&o.return&&o.return()}finally{if(a)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};e.default=Discourse.Route.extend({model:function(){return Ember.RSVP.Promise.all([(0,n.ajax)("/patreon/list.json"),t.default.findAll({ignore_automatic:!0})]).then(function(e){var t=a(e,2),n=t[0],r=t[1];return r=r.map(function(e){return{id:e.id,name:e.name}}),{filters:n.filters,rewards:n.rewards,last_sync_at:n.last_sync_at,groups:r}})},setupController:function(e,t){var a=t.rewards,s=t.groups,n=_.map(t.filters,function(e,t){var n=e.map(function(e){return a[e]?" $"+a[e].amount_cents/100+" - "+a[e].title:""}),r=_.find(s,function(e){return e.id===parseInt(t,10)});return i.default.create({group:r.name,rewards:n,group_id:t,reward_ids:e})});e.setProperties({model:n,groups:s,rewards:a,last_sync_at:t.last_sync_at})}})}),define("discourse/plugins/discourse-patreon/discourse/patreon-route-map",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={resource:"admin.adminPlugins",path:"/plugins",map:function(){this.route("patreon")}}}),define("discourse/plugins/discourse-patreon/discourse/models/filter-rule",["exports","discourse/models/rest"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.default.extend({group_id:-1,reward_list:""})}),define("discourse/plugins/discourse-patreon/discourse/controllers/admin-plugins-patreon",["exports","ember-addons/ember-computed-decorators","discourse/plugins/discourse-patreon/discourse/models/filter-rule","discourse/lib/ajax","discourse/lib/ajax-error"],function(e,t,s,i,o){"use strict";var n,r,a,l,u,d,c,p;Object.defineProperty(e,"__esModule",{value:!0}),e.default=Ember.Controller.extend((n=(0,t.default)("rewards"),r={prettyPrintReward:function(e){return"$"+e.amount_cents/100+" - "+e.title},rewardsNames:function(){var t=this;return _.filter(this.rewards,function(e){return 0<=e.id}).map(function(e){return t.prettyPrintReward(e)})},editing:s.default.create({group_id:null}),actions:{save:function(){var n=this,r=this.get("editing"),a=this.get("model");r.set("group",this.groups.find(function(e){return e.id===parseInt(r.get("group_id"),10)})),r.set("rewards_ids",_.filter(this.rewards,function(e){return r.get("reward_list").includes(n.prettyPrintReward(e))}).map(function(e){return e.id})),(0,i.ajax)("/patreon/list.json",{method:"POST",data:r.getProperties("group_id","rewards_ids")}).then(function(){var e=a.find(function(e){return e.get("group_id")===r.get("group_id")}),t=r.get("reward_list").filter(Boolean);e?(e.set("reward_list",t),e.set("rewards",t),e.set("rewards_ids",r.rewards_ids)):a.pushObject(s.default.create({group:r.get("group.name"),rewards:t})),n.set("editing",s.default.create({group_id:null}))}).catch(o.popupAjaxError)},delete:function(t){var n=this.get("model");(0,i.ajax)("/patreon/list.json",{method:"DELETE",data:t.getProperties("group_id")}).then(function(){var e=n.find(function(e){return e.get("group_id")===t.get("group_id")});n.removeObject(e)}).catch(o.popupAjaxError)},updateData:function(){var e=this;this.set("updatingData",!0),(0,i.ajax)("/patreon/update_data.json",{method:"POST"}).catch(o.popupAjaxError).finally(function(){return e.set("updatingData",!1)}),this.messageBus.subscribe("/patreon/background_sync",function(){e.messageBus.unsubscribe("/patreon/background_sync"),e.set("updatingData",!1),bootbox.alert(I18n.t("patreon.refresh_page"),function(){window.location.pathname=Discourse.getURL("/admin/plugins/patreon")})})}}},a=r,l="rewardsNames",u=[n],d=Object.getOwnPropertyDescriptor(r,"rewardsNames"),c=r,p={},Object.keys(d).forEach(function(e){p[e]=d[e]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=u.slice().reverse().reduce(function(e,t){return t(a,l,e)||e},p),c&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(c):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(a,l,p),p=null),r))}),Ember.TEMPLATES["javascripts/connectors/topic-above-footer-buttons/patreon"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[24,["showDonationPrompt"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","patreon-donation-prompt"],[8],[0,"\\n    "],[7,"span",false],[12,"class","close"],[3,"action",[[23,0,[]],"close"]],[8],[0,"\\n      "],[1,[28,"d-icon",["times"],null],false],[0,"\\n    "],[9],[0,"\\n\\n    "],[1,[28,"i18n",["patreon.donation_prompt.body"],[["campaignUrl"],[[24,["siteSettings","patreon_donation_prompt_campaign_url"]]]]],true],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/topic-above-footer-buttons/patreon"}}),define("discourse/plugins/discourse-patreon/discourse/templates/connectors/admin-user-details/patreon",["exports","discourse/lib/ajax","discourse/lib/url"],function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,t){return t.siteSettings.patreon_enabled&&e.model.patreon_id},actions:{checkPatreonEmail:function(e){var r=this;(0,t.ajax)((0,n.userPath)(e.username_lower+"/patreon_email.json"),{data:{context:window.location.pathname}}).then(function(e){if(e){var t=e.email,n="https://patreon.com/members";t&&(n=n+"?query="+t),r.set("patreon_email",t),r.set("patron_url",n)}})}}}}),Ember.TEMPLATES["javascripts/connectors/admin-user-details/patreon"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"section",true],[10,"class","details"],[8],[0,"\\n  "],[7,"h1",true],[8],[1,[28,"i18n",["patreon.title"],null],false],[9],[0,"\\n  "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n    "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.id"],null],false],[9],[0,"\\n    "],[7,"div",true],[10,"class","value"],[8],[1,[24,["model","patreon_id"]],false],[9],[0,"\\n  "],[9],[0,"\\n"],[4,"if",[[24,["model","patreon_email_exists"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n    "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.email"],null],false],[9],[0,"\\n    "],[7,"div",true],[10,"class","value"],[8],[0,"\\n"],[4,"if",[[24,["patreon_email"]]],null,{"statements":[[0,"        "],[1,[22,"patreon_email"],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"        "],[1,[28,"d-button",null,[["class","action","actionParam","icon","label","title"],["btn-default","checkPatreonEmail",[24,["model"]],"far-envelope","admin.users.check_email.text","admin.users.check_email.title"]]],false],[0,"\\n"]],"parameters":[]}],[0,"    "],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null],[4,"if",[[24,["model","patreon_amount_cents"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n    "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.amount_cents"],null],false],[9],[0,"\\n    "],[7,"div",true],[10,"class","value"],[8],[1,[24,["model","patreon_amount_cents"]],false],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null],[4,"if",[[24,["model","patreon_rewards"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n    "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.rewards"],null],false],[9],[0,"\\n    "],[7,"div",true],[10,"class","value"],[8],[1,[24,["model","patreon_rewards"]],false],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null],[4,"if",[[24,["model","patreon_declined_since"]]],null,{"statements":[[0,"  "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n    "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.declined_since"],null],false],[9],[0,"\\n    "],[7,"div",true],[10,"class","value"],[8],[1,[28,"format-date",[[24,["model","patreon_declined_since"]]],null],true],[9],[0,"\\n  "],[9],[0,"\\n"]],"parameters":[]},null],[0,"  "],[7,"div",true],[10,"class","display-row"],[8],[0,"\\n    "],[7,"div",true],[10,"class","field"],[8],[1,[28,"i18n",["patreon.field.more_details.label"],null],false],[9],[0,"\\n    "],[7,"div",true],[10,"class","value"],[8],[7,"a",true],[10,"target","_blank"],[11,"href",[29,[[22,"patron_url"]]]],[8],[1,[28,"d-icon",["external-link-alt"],null],false],[9],[9],[0,"\\n    "],[7,"div",true],[10,"class","controls"],[8],[0,"\\n"],[4,"if",[[24,["model","patreon_email"]]],null,{"statements":[[0,"        "],[1,[28,"i18n",["patreon.field.more_details.help_text.email_available"],null],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"        "],[1,[28,"i18n",["patreon.field.more_details.help_text.email_not_available"],null],false],[0,"\\n"]],"parameters":[]}],[0,"    "],[9],[0,"\\n  "],[9],[0,"\\n"],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/admin-user-details/patreon"}}),Ember.TEMPLATES["javascripts/admin/plugins-patreon"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["rule"],"statements":[[7,"section",true],[10,"id","patreon"],[8],[0,"\\n  "],[7,"h1",true],[8],[1,[28,"i18n",["patreon.header.rules"],null],false],[9],[0,"\\n  "],[7,"table",true],[8],[0,"\\n    "],[7,"tr",true],[8],[0,"\\n      "],[7,"th",true],[8],[1,[28,"i18n",["patreon.group"],null],false],[9],[0,"\\n      "],[7,"th",true],[8],[1,[28,"i18n",["patreon.rewards"],null],false],[9],[0,"\\n      "],[7,"th",true],[8],[9],[0,"\\n    "],[9],[0,"\\n\\n"],[4,"each",[[24,["model"]]],null,{"statements":[[0,"      "],[7,"tr",true],[10,"class",""],[8],[0,"\\n        "],[7,"td",true],[8],[1,[23,1,["group"]],false],[9],[0,"\\n        "],[7,"td",true],[8],[1,[23,1,["rewards"]],false],[9],[0,"\\n        "],[7,"td",true],[8],[0,"\\n          "],[7,"div",true],[10,"class","pull-right"],[8],[0,"\\n            "],[1,[28,"d-button",null,[["action","actionParam","icon","class","title"],["delete",[23,1,[]],"far-trash-alt","delete btn-danger","patreon.delete"]]],false],[0,"\\n          "],[9],[0,"\\n        "],[9],[0,"\\n      "],[9],[0,"\\n"]],"parameters":[1]},null],[0,"\\n    "],[7,"tr",true],[10,"class","new-filter"],[8],[0,"\\n      "],[7,"td",true],[8],[1,[28,"combo-box",null,[["value","content","nameProperty","valueProperty","none"],[[24,["editing","group_id"]],[24,["groups"]],"name","id","patreon.select_group"]]],false],[9],[0,"\\n      "],[7,"td",true],[8],[1,[28,"list-setting",null,[["value","choices","class"],[[24,["editing","reward_list"]],[24,["rewardsNames"]],"rewards"]]],false],[9],[0,"\\n      "],[7,"td",true],[8],[0,"\\n        "],[7,"div",true],[10,"class","pull-right"],[8],[0,"\\n          "],[1,[28,"d-button",null,[["action","icon","class","title"],["save","check","save btn-primary","patreon.save"]]],false],[0,"\\n        "],[9],[0,"\\n      "],[9],[0,"\\n    "],[9],[0,"\\n  "],[9],[0,"\\n\\n  "],[7,"p",true],[8],[1,[28,"i18n",["patreon.help_text"],null],false],[9],[0,"\\n\\n  "],[1,[28,"d-button",null,[["action","icon","class","disabled","title","label"],["updateData","refresh","test",[24,["updatingData"]],"patreon.update_data","patreon.update_data"]]],false],[0,"\\n\\n"],[4,"if",[[24,["last_sync_at"]]],null,{"statements":[[0,"    "],[7,"span",true],[10,"class","last_synced"],[8],[1,[28,"i18n",["patreon.last_synced"],null],false],[0,": "],[1,[28,"format-date",[[24,["last_sync_at"]]],[["leaveAgo"],["true"]]],true],[9],[0,"\\n"]],"parameters":[]},null],[9],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/admin/plugins-patreon"}}),define("discourse/plugins/discourse-patreon/discourse/initializers/patreon",["exports","discourse/lib/plugin-api"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=0,a="PatreonDonationPromptClosed";function n(e){var n=e.getCurrentUser();e.onAppEvent("page:topic-loaded",function(e){if(e){var t=e.isPrivateMessage;n&&!t&&r<=e.siteSettings.patreon_donation_prompt_show_after_topics&&r++}}),e.registerConnectorClass("topic-above-footer-buttons","patreon",{shouldRender:function(e,t){return t.currentUser},setupComponent:function(e,t){t.didInsertElement=function(){var e=this.siteSettings.patreon_enabled&&this.siteSettings.patreon_donation_prompt_enabled&&""!==this.siteSettings.patreon_donation_prompt_campaign_url&&this.currentUser.show_donation_prompt&&"t"!==$.cookie(a)&&r>this.siteSettings.patreon_donation_prompt_show_after_topics;this.set("showDonationPrompt",e)}},actions:{close:function(){var e=moment().add(30,"d").toDate();$.cookie(a,"t",{expires:e}),this.$().fadeOut(700)}}})}e.default={name:"patreon",initialize:function(){(0,t.withPluginApi)("0.8",n)}}});
//# sourceMappingURL=/assets/plugins/discourse-patreon-9bae9a1e5ce43d066942c7d9a012f64deb4ad6d20cafaa6d7a4bdf658ce54259.js.map